import{c as Z,r as a,m as l,j as t,f as u,g as U,h as ee,e as te,v as re,w as oe,n as ne,x as se,l as ae,y as ie,o as ce,I as $,z as de,P as le,B as v,t as f}from"./index-BpfM_tVL.js";import{u as b,a as pe,b as he,s as S,d as R,P as F,F as ue,f as A,H as I,c as me,S as fe,e as ge}from"./MainPage-CKUs5LFY.js";import{c as x,T as h,B as xe,I as Pe,V as we}from"./config-B27R141A.js";import{G as ve,D as je,a as ye,b as Ce,c as Ae,d as $e,e as be,f as E}from"./dialog-B1ssuuyl.js";import{F as Te}from"./field-Dn6ntP2Z.js";import{B as De}from"./badge-B6TjbCwD.js";const[N,m]=Z({name:"PopoverContext",hookName:"usePopoverContext",providerName:"<PopoverProvider />"}),_=a.forwardRef((e,r)=>{const o=m(),n=l(o.getAnchorProps(),e);return t.jsx(u.div,{...n,ref:r})});_.displayName="PopoverAnchor";const B=a.forwardRef((e,r)=>{const o=m(),n=l(o.getArrowProps(),e);return t.jsx(u.div,{...n,ref:r})});B.displayName="PopoverArrow";const L=a.forwardRef((e,r)=>{const o=m(),n=l(o.getArrowTipProps(),e);return t.jsx(u.div,{...n,ref:r})});L.displayName="PopoverArrowTip";const O=a.forwardRef((e,r)=>{const o=m(),n=l(o.getCloseTriggerProps(),e);return t.jsx(u.button,{...n,ref:r})});O.displayName="PopoverCloseTrigger";const z=a.forwardRef((e,r)=>{const o=m(),n=b(),s=l(o.getContentProps(),n.getPresenceProps(),e);return n.unmounted?null:t.jsx(u.div,{...s,ref:U(n.ref,r)})});z.displayName="PopoverContent";const J=a.forwardRef((e,r)=>{const o=m(),n=l(o.getDescriptionProps(),e);return t.jsx(u.div,{...n,ref:r})});J.displayName="PopoverDescription";const G=a.forwardRef((e,r)=>{const o=m(),n=l(o.getIndicatorProps(),e);return t.jsx(u.div,{...n,ref:r})});G.displayName="PopoverIndicator";const H=a.forwardRef((e,r)=>{const o=m(),n=b(),s=l(o.getPositionerProps(),e);return n.unmounted?null:t.jsx(u.div,{...s,ref:r})});H.displayName="PopoverPositioner";const Ee=(e={})=>{const{getRootNode:r}=ee(),{dir:o}=pe(),n={id:a.useId(),dir:o,getRootNode:r,open:e.defaultOpen,"open.controlled":e.open!==void 0,...e},s={...n,open:e.open,onOpenChange:he(e.onOpenChange,{sync:!0})},[i,p]=te(re(n),{context:s});return oe(i,p,ne)},ke=e=>{const[r,{children:o,...n}]=S(e),s=Ee(n),i=R(l({present:s.open},r));return t.jsx(N,{value:s,children:t.jsx(F,{value:i,children:o})})},Se=e=>{const[r,{value:o,children:n}]=S(e),s=R(l({present:o.open},r));return t.jsx(N,{value:o,children:t.jsx(F,{value:s,children:n})})},W=a.forwardRef((e,r)=>{const o=m(),n=l(o.getTitleProps(),e);return t.jsx(u.div,{...n,ref:r})});W.displayName="PopoverTitle";const K=a.forwardRef((e,r)=>{const o=m(),n=b(),s=l({...o.getTriggerProps(),"aria-controls":n.unmounted?void 0:o.getTriggerProps()["aria-controls"]},e);return t.jsx(u.button,{...s,ref:r})});K.displayName="PopoverTrigger";function k(e){return ie(e,r=>r==="auto"?"auto":`span ${r}/span ${r}`)}const P=a.forwardRef(function(r,o){const{area:n,colSpan:s,colStart:i,colEnd:p,rowEnd:g,rowSpan:c,rowStart:j,...y}=r,w=se({gridArea:n,gridColumn:k(s),gridRow:k(c),gridColumnStart:i,gridColumnEnd:p,gridRowStart:j,gridRowEnd:g});return t.jsx(ae.div,{ref:o,css:w,...y})}),{withRootProvider:V,withContext:d,useStyles:dt,PropsProvider:lt}=ce({key:"popover"});V(Se);const Re=V(ke),Fe=d(K,"trigger",{forwardAsChild:!0}),Ie=d(H,"positioner",{forwardAsChild:!0}),Ne=d(z,"content",{forwardAsChild:!0}),_e=d(B,"arrow",{forwardAsChild:!0}),Be=d(L,"arrowTip",{forwardAsChild:!0}),Le=d(O,"closeTrigger",{forwardAsChild:!0});d(G,"indicator",{forwardAsChild:!0});d(W,"title",{forwardAsChild:!0});d(J,"description",{forwardAsChild:!0});d("footer","footer");d("header","header");const Oe=d("div","body");d(_,void 0,{forwardAsChild:!0});const ze=async e=>{try{const r=await fetch(`${x.backendPath}/api/activities/${e}/participants`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to fetch participants for activity ID ${e}`);return await r.json()}catch(r){throw console.error("Error fetching participants:",r),r}},Je=async e=>{try{const r=await fetch(`${x.backendPath}/api/activities/${e}/comments`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to fetch comments for activity ID ${e}`);return await r.json()}catch(r){throw console.error("Error fetching comments:",r),r}},Ge=a.forwardRef(function(r,o){return t.jsx($,{variant:"ghost","aria-label":"Close",ref:o,...r,children:r.children??t.jsx(de,{})})}),He=a.forwardRef(function(r,o){const{portalled:n=!0,portalRef:s,...i}=r;return t.jsx(le,{disabled:!n,container:s,children:t.jsx(Ie,{children:t.jsx(Ne,{ref:o,...i})})})}),We=a.forwardRef(function(r,o){return t.jsx(_e,{...r,ref:o,children:t.jsx(Be,{})})});a.forwardRef(function(r,o){return t.jsx(Le,{position:"absolute",top:"1",insetEnd:"1",...r,asChild:!0,ref:o,children:t.jsx(Ge,{size:"sm"})})});const Ke=Re,Ve=Oe,Me=Fe,Xe=async e=>{try{const r=await fetch(`${x.backendPath}/api/activities/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to delete activity of ID ${e}`);return await r.json()}catch(r){throw console.error("Error deleting activity:",r),r}},Ye=({activity:e,onClose:r})=>{const[o,n]=a.useState(!1),s=async()=>{try{await Xe(e.activity_id),r(),f.create({description:`Deleted ${e.activity_id}:${e.title}`,type:"success"})}catch(i){f.create({description:`Failed to delete ${e.title}: ${i}`,type:"error"})}};return t.jsxs(Ke,{open:o,onOpenChange:i=>n(i.open),children:[t.jsx(Me,{children:t.jsx($,{variant:"outline",colorPalette:"teal",children:t.jsx(ue,{})})}),t.jsxs(He,{width:"160px",children:[t.jsx(We,{}),t.jsxs(Ve,{children:[t.jsx(h,{textAlign:"center",fontSize:"md",children:"Are you sure?"}),t.jsx(v,{width:"full",marginTop:2,onClick:s,children:"Delete"})]})]})]})},qe=({activity:e,participants:r,loading:o})=>t.jsxs(t.Fragment,{children:[t.jsx(h,{textAlign:"left",fontSize:"md",color:"gray.500",mb:8,children:e.description}),t.jsxs(ve,{templateColumns:"repeat(2, 1fr)",overflow:"hidden",children:[t.jsx(P,{alignContent:"start",children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Duration:"})," ",A(e.start_date)," - ",A(e.end_date)]})}),t.jsx(P,{children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Location:"})," ",e.location]})}),t.jsx(P,{children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Status:"})," ",e.status]})}),t.jsx(P,{children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Vacancy:"})," ",e.participant_count,"/",e.max_participants]})}),t.jsx(P,{colSpan:2,children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Participants:"})," ",o?"Loading...":r.length===0?"None":r.map(n=>n.user_name).join(", ")]})})]})]}),Qe=({comment:e})=>t.jsxs(xe,{children:[t.jsxs(h,{textAlign:"start",color:"teal.300",children:[A(e.created_at),": ",t.jsx("strong",{children:e.user_name})]}),t.jsx(h,{textAlign:"start",color:"gray.300",children:e.comment_body})]}),Ze=async(e,r,o)=>{try{const n=await fetch(`${x.backendPath}/api/activities/${o}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,comment_body:r})});if(!n.ok)throw new Error(`Failed to add comment for activity ID ${o}`);return await n.json()}catch(n){throw console.error("Error adding comment:",n),n}},Ue=({activity:e,comments:r,user_id:o,onUpdateData:n})=>{const[s,i]=a.useState(""),p=async()=>{try{if(s=="")throw new Error("Comment cannot be empty!");if(s.length>300)throw new Error("Comment cannot be more than 300 characters!");await Ze(o,s,e.activity_id),i(""),n(),f.create({description:"Added Comment",type:"success"})}catch(c){f.create({description:`Failed to add Comment: ${c}`,type:"error"})}},g=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),p())};return t.jsxs(t.Fragment,{children:[t.jsxs(I,{marginTop:8,children:[t.jsx(Te,{width:"5/6",errorText:"Comment cannot be more than 300 characters!",invalid:s.length>300,children:t.jsx(Pe,{value:s,onChange:c=>i(c.target.value),placeholder:"Write your comment here...",size:"md",onKeyDown:g})}),t.jsx(v,{width:"1/6",colorScheme:"teal",onClick:p,disabled:!s,children:"Submit"})]}),t.jsx(we,{spaceY:2,p:2,width:"full",align:"stretch",children:r.map(c=>t.jsx(Qe,{comment:c},c.comment_id))})]})},et=async(e,r)=>{try{const o=await fetch(`${x.backendPath}/api/activities/${r}/participants`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e})});if(!o.ok)throw new Error(`Failed to add participant for activity ID ${r}`);return await o.json()}catch(o){throw console.error("Error adding participant:",o),o}},tt=async(e,r)=>{try{const o=await fetch(`${x.backendPath}/api/activities/${r}/participants`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e})});if(!o.ok)throw new Error(`Failed to delete participant for activity ID ${r}`);return await o.json()}catch(o){throw console.error("Error deleting participant:",o),o}},rt=({activity:e,isParticipant:r,user_id:o,onClose:n,onUpdateData:s})=>{const i=async()=>{r?g():p(),n()},p=async()=>{try{if(e.participant_count===e.max_participants)throw new Error("Activity already full!");await et(o,e.activity_id),s(),f.create({description:`Joined ${e.activity_id}:${e.title}`,type:"success"})}catch(c){f.create({description:`Failed to join ${e.title}: ${c}`,type:"error"})}},g=async()=>{try{await tt(o,e.activity_id),s(),f.create({description:`Left ${e.activity_id}:${e.title}`,type:"success"})}catch(c){f.create({description:`Failed to leave ${e.title}: ${c}`,type:"error"})}};return t.jsx(v,{variant:"subtle",colorPalette:"teal",onClick:i,width:"20%",children:r?"Leave":"Join"})},pt=({activity:e,onClose:r,onUpdateData:o,onEdit:n,user_id:s})=>{const[i,p]=a.useState([]),[g,c]=a.useState([]),[j,y]=a.useState(!0),[w,M]=a.useState(!0),X=i.map(T=>T.user_id).includes(s);a.useEffect(()=>{(async()=>{try{const C=await ze(e.activity_id);p(C);const D=await Je(e.activity_id);D.sort((q,Q)=>new Date(Q.created_at).getTime()-new Date(q.created_at).getTime()),c(D)}catch(C){console.error("Error fetching data:",C)}finally{y(!1)}})()},[w]);const Y=()=>{M(!w)};return t.jsxs(je,{open:!0,onInteractOutside:r,size:"xl",children:[t.jsx(ye,{}),t.jsxs(Ce,{colorScheme:"teal",overflow:"auto",maxH:"80vh",css:{"&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1"},"&::-webkit-scrollbar-thumb":{background:"teal",borderRadius:"8px"},"&::-webkit-scrollbar-thumb:hover":{background:"teal.700"},scrollbarWidth:"thin",scrollbarColor:"teal #f1f1f1"},children:[t.jsx(Ae,{children:t.jsxs(I,{align:"center",children:[t.jsx(h,{fontSize:"2xl",fontWeight:"bold",color:"teal.600",textAlign:"left",maxW:"50%",children:e.title}),t.jsx(De,{colorPalette:me.get(e.category),children:e.category}),t.jsx(fe,{}),t.jsx($,{variant:"outline",onClick:()=>n(e),colorPalette:"teal",children:t.jsx(ge,{})}),t.jsx(Ye,{activity:e,onClose:()=>{o(),r()}})]})}),t.jsxs($e,{children:[t.jsx(qe,{activity:e,participants:i,loading:j}),t.jsx(Ue,{activity:e,comments:g,user_id:s,onUpdateData:Y})]}),t.jsxs(be,{children:[t.jsx(E,{asChild:!0,children:t.jsx(rt,{activity:e,isParticipant:X,user_id:s,onClose:r,onUpdateData:o})}),t.jsx(E,{asChild:!0,children:t.jsx(v,{variant:"outline",onClick:r,children:"Exit"})})]})]})]})};export{pt as default};
