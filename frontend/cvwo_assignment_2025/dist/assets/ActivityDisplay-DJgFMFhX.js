import{c as U,r as a,m as l,j as r,f as u,g as ee,h as re,e as te,v as oe,w as ne,n as se,x as ae,l as ie,y as ce,o as de,I as b,z as le,P as pe,B as w,t as g}from"./index-DAGeL9RU.js";import{u as T,a as he,b as ue,s as R,d as F,P as N,F as me,f as A,H as I,c as ge,S as xe,e as fe}from"./MainPage-BtkjbPYZ.js";import{c as f,T as h,B as Pe,I as we,V as ve}from"./config-C-JR7vwZ.js";import{G as je,D as Ce,a as ye,b as Ae,c as be,d as Te,e as $e,f as k}from"./dialog-D89LgX20.js";import{F as De}from"./field-bOODKLtN.js";import{B as Ee}from"./badge-DX2y2vrz.js";const[B,m]=U({name:"PopoverContext",hookName:"usePopoverContext",providerName:"<PopoverProvider />"}),_=a.forwardRef((t,e)=>{const o=m(),n=l(o.getAnchorProps(),t);return r.jsx(u.div,{...n,ref:e})});_.displayName="PopoverAnchor";const L=a.forwardRef((t,e)=>{const o=m(),n=l(o.getArrowProps(),t);return r.jsx(u.div,{...n,ref:e})});L.displayName="PopoverArrow";const O=a.forwardRef((t,e)=>{const o=m(),n=l(o.getArrowTipProps(),t);return r.jsx(u.div,{...n,ref:e})});O.displayName="PopoverArrowTip";const z=a.forwardRef((t,e)=>{const o=m(),n=l(o.getCloseTriggerProps(),t);return r.jsx(u.button,{...n,ref:e})});z.displayName="PopoverCloseTrigger";const J=a.forwardRef((t,e)=>{const o=m(),n=T(),s=l(o.getContentProps(),n.getPresenceProps(),t);return n.unmounted?null:r.jsx(u.div,{...s,ref:ee(n.ref,e)})});J.displayName="PopoverContent";const G=a.forwardRef((t,e)=>{const o=m(),n=l(o.getDescriptionProps(),t);return r.jsx(u.div,{...n,ref:e})});G.displayName="PopoverDescription";const H=a.forwardRef((t,e)=>{const o=m(),n=l(o.getIndicatorProps(),t);return r.jsx(u.div,{...n,ref:e})});H.displayName="PopoverIndicator";const K=a.forwardRef((t,e)=>{const o=m(),n=T(),s=l(o.getPositionerProps(),t);return n.unmounted?null:r.jsx(u.div,{...s,ref:e})});K.displayName="PopoverPositioner";const ke=(t={})=>{const{getRootNode:e}=re(),{dir:o}=he(),n={id:a.useId(),dir:o,getRootNode:e,open:t.defaultOpen,"open.controlled":t.open!==void 0,...t},s={...n,open:t.open,onOpenChange:ue(t.onOpenChange,{sync:!0})},[i,p]=te(oe(n),{context:s});return ne(i,p,se)},Se=t=>{const[e,{children:o,...n}]=R(t),s=ke(n),i=F(l({present:s.open},e));return r.jsx(B,{value:s,children:r.jsx(N,{value:i,children:o})})},Re=t=>{const[e,{value:o,children:n}]=R(t),s=F(l({present:o.open},e));return r.jsx(B,{value:o,children:r.jsx(N,{value:s,children:n})})},V=a.forwardRef((t,e)=>{const o=m(),n=l(o.getTitleProps(),t);return r.jsx(u.div,{...n,ref:e})});V.displayName="PopoverTitle";const M=a.forwardRef((t,e)=>{const o=m(),n=T(),s=l({...o.getTriggerProps(),"aria-controls":n.unmounted?void 0:o.getTriggerProps()["aria-controls"]},t);return r.jsx(u.button,{...s,ref:e})});M.displayName="PopoverTrigger";function S(t){return ce(t,e=>e==="auto"?"auto":`span ${e}/span ${e}`)}const P=a.forwardRef(function(e,o){const{area:n,colSpan:s,colStart:i,colEnd:p,rowEnd:x,rowSpan:c,rowStart:v,...j}=e,C=ae({gridArea:n,gridColumn:S(s),gridRow:S(c),gridColumnStart:i,gridColumnEnd:p,gridRowStart:v,gridRowEnd:x});return r.jsx(ie.div,{ref:o,css:C,...j})}),{withRootProvider:W,withContext:d,useStyles:lr,PropsProvider:pr}=de({key:"popover"});W(Re);const Fe=W(Se),Ne=d(M,"trigger",{forwardAsChild:!0}),Ie=d(K,"positioner",{forwardAsChild:!0}),Be=d(J,"content",{forwardAsChild:!0}),_e=d(L,"arrow",{forwardAsChild:!0}),Le=d(O,"arrowTip",{forwardAsChild:!0}),Oe=d(z,"closeTrigger",{forwardAsChild:!0});d(H,"indicator",{forwardAsChild:!0});d(V,"title",{forwardAsChild:!0});d(G,"description",{forwardAsChild:!0});d("footer","footer");d("header","header");const ze=d("div","body");d(_,void 0,{forwardAsChild:!0});const Je=async t=>{try{const e=await fetch(`${f.backendPath}/api/activities/${t}/participants`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch participants for activity ID ${t}`);return await e.json()}catch(e){throw console.error("Error fetching participants:",e),e}},Ge=async t=>{try{const e=await fetch(`${f.backendPath}/api/activities/${t}/comments`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch comments for activity ID ${t}`);return await e.json()}catch(e){throw console.error("Error fetching comments:",e),e}},He=a.forwardRef(function(e,o){return r.jsx(b,{variant:"ghost","aria-label":"Close",ref:o,...e,children:e.children??r.jsx(le,{})})}),Ke=a.forwardRef(function(e,o){const{portalled:n=!0,portalRef:s,...i}=e;return r.jsx(pe,{disabled:!n,container:s,children:r.jsx(Ie,{children:r.jsx(Be,{ref:o,...i})})})}),Ve=a.forwardRef(function(e,o){return r.jsx(_e,{...e,ref:o,children:r.jsx(Le,{})})});a.forwardRef(function(e,o){return r.jsx(Oe,{position:"absolute",top:"1",insetEnd:"1",...e,asChild:!0,ref:o,children:r.jsx(He,{size:"sm"})})});const Me=Fe,We=ze,Xe=Ne,Ye=async t=>{try{const e=await fetch(`${f.backendPath}/api/activities/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to delete activity of ID ${t}`);return await e.json()}catch(e){throw console.error("Error deleting activity:",e),e}},qe=({activity:t,onClose:e})=>{const[o,n]=a.useState(!1),s=async()=>{try{await Ye(t.activity_id),e(),g.create({description:`Deleted ${t.title}`,type:"success"})}catch(i){g.create({description:`Failed to delete ${t.title}: ${i}`,type:"error"})}};return r.jsxs(Me,{open:o,onOpenChange:i=>n(i.open),children:[r.jsx(Xe,{children:r.jsx(b,{variant:"outline",colorPalette:"teal",children:r.jsx(me,{})})}),r.jsxs(Ke,{width:"160px",children:[r.jsx(Ve,{}),r.jsxs(We,{children:[r.jsx(h,{textAlign:"center",fontSize:"md",children:"Are you sure?"}),r.jsx(w,{width:"full",marginTop:2,onClick:s,children:"Delete"})]})]})]})},Qe=({activity:t,participants:e,loading:o})=>r.jsxs(r.Fragment,{children:[r.jsx(h,{textAlign:"left",fontSize:"md",color:"gray.500",mb:8,children:t.description}),r.jsxs(je,{templateColumns:"repeat(2, 1fr)",width:"80%",overflow:"hidden",children:[r.jsx(P,{alignContent:"start",children:r.jsxs(h,{textAlign:"start",lineClamp:1,children:[r.jsx("strong",{children:"Duration:"})," ",A(t.start_date)," - ",A(t.end_date)]})}),r.jsx(P,{children:r.jsxs(h,{textAlign:"start",lineClamp:1,children:[r.jsx("strong",{children:"Location:"})," ",t.location]})}),r.jsx(P,{children:r.jsxs(h,{textAlign:"start",lineClamp:1,children:[r.jsx("strong",{children:"Status:"})," ",t.status]})}),r.jsx(P,{children:r.jsxs(h,{textAlign:"start",lineClamp:1,children:[r.jsx("strong",{children:"Vacancy:"})," ",t.participant_count,"/",t.max_participants]})}),r.jsx(P,{colSpan:2,children:r.jsxs(h,{textAlign:"start",lineClamp:1,children:[r.jsx("strong",{children:"Participants:"})," ",o?"Loading...":e.length===0?"None":e.map(n=>n.user_name).join(", ")]})})]})]}),Ze=({comment:t})=>r.jsxs(Pe,{children:[r.jsxs(h,{textAlign:"start",color:"teal.300",children:[A(t.created_at),": ",r.jsx("strong",{children:t.user_name})]}),r.jsx(h,{textAlign:"start",color:"gray.300",children:t.comment_body})]}),Ue=async(t,e,o)=>{try{const n=await fetch(`${f.backendPath}/api/activities/${o}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t,comment_body:e})});if(!n.ok)throw new Error(`Failed to add comment for activity ID ${o}`);return await n.json()}catch(n){throw console.error("Error adding comment:",n),n}},er=({activity:t,comments:e,user_id:o,onUpdateData:n})=>{const[s,i]=a.useState(""),p=async()=>{try{if(s=="")throw new Error("Comment cannot be empty!");if(s.length>300)throw new Error("Comment cannot be more than 300 characters!");await Ue(o,s,t.activity_id),i(""),n(),g.create({description:"Added Comment",type:"success"})}catch(c){g.create({description:`Failed to add Comment: ${c}`,type:"error"})}},x=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),p())};return r.jsxs(r.Fragment,{children:[r.jsxs(I,{marginTop:8,children:[r.jsx(De,{width:"5/6",errorText:"Comment cannot be more than 300 characters!",invalid:s.length>300,children:r.jsx(we,{value:s,onChange:c=>i(c.target.value),placeholder:"Write your comment here...",size:"md",onKeyDown:x})}),r.jsx(w,{width:"1/6",colorScheme:"teal",onClick:p,disabled:!s,children:"Submit"})]}),r.jsx(ve,{spaceY:2,p:2,width:"full",align:"stretch",children:e.map(c=>r.jsx(Ze,{comment:c},c.comment_id))})]})},rr=async(t,e)=>{try{const o=await fetch(`${f.backendPath}/api/activities/${e}/participants`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t})});if(!o.ok)throw new Error(`Failed to add participant for activity ID ${e}`);return await o.json()}catch(o){throw console.error("Error adding participant:",o),o}},tr=async(t,e)=>{try{const o=await fetch(`${f.backendPath}/api/activities/${e}/participants`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t})});if(!o.ok)throw new Error(`Failed to delete participant for activity ID ${e}`);return await o.json()}catch(o){throw console.error("Error deleting participant:",o),o}},or=({activity:t,isParticipant:e,user_id:o,onClose:n,onUpdateData:s})=>{const i=async()=>{e?x():p(),n()},p=async()=>{try{if(t.participant_count===t.max_participants)throw new Error("Activity already full!");await rr(o,t.activity_id),s(),g.create({description:`Joined ${t.title}`,type:"success"})}catch(c){g.create({description:`Failed to join ${t.title}: ${c}`,type:"error"})}},x=async()=>{try{await tr(o,t.activity_id),s(),g.create({description:`Left ${t.title}`,type:"success"})}catch(c){g.create({description:`Failed to leave ${t.title}: ${c}`,type:"error"})}};return r.jsx(w,{variant:"subtle",colorPalette:"teal",onClick:i,width:"20%",children:e?"Leave":"Join"})},hr=({isOpen:t,activity:e,onClose:o,onUpdateData:n,onEdit:s,user_id:i})=>{const[p,x]=a.useState([]),[c,v]=a.useState([]),[j,C]=a.useState(!0),[$,X]=a.useState(!0),Y=p.map(D=>D.user_id).includes(i);a.useEffect(()=>{(async()=>{try{const y=await Je(e.activity_id);x(y);const E=await Ge(e.activity_id);E.sort((Q,Z)=>new Date(Z.created_at).getTime()-new Date(Q.created_at).getTime()),v(E)}catch(y){console.error("Error fetching data:",y)}finally{C(!1)}})()},[$]);const q=()=>{X(!$)};return r.jsxs(Ce,{open:t,size:"xl",children:[r.jsx(ye,{}),r.jsxs(Ae,{colorScheme:"teal",overflow:"auto",maxH:"80vh",css:{"::-webkit-scrollbar":{width:"8px",height:"8px"},"::-webkit-scrollbar-thumb":{backgroundColor:"teal.500",borderRadius:"4px",border:"2px solid transparent",backgroundClip:"content-box"},"::-webkit-scrollbar-thumb:hover":{backgroundColor:"teal.700"},"::-webkit-scrollbar-track":{backgroundColor:"gray.200",borderRadius:"4px"}},children:[r.jsx(be,{children:r.jsxs(I,{align:"center",children:[r.jsx(h,{fontSize:"2xl",fontWeight:"bold",color:"teal.600",children:e.title}),r.jsx(Ee,{colorPalette:ge.get(e.category),children:e.category}),r.jsx(xe,{}),r.jsx(b,{variant:"outline",onClick:()=>s(e),colorPalette:"teal",children:r.jsx(fe,{})}),r.jsx(qe,{activity:e,onClose:()=>{n(),o()}})]})}),r.jsxs(Te,{children:[r.jsx(Qe,{activity:e,participants:p,loading:j}),r.jsx(er,{activity:e,comments:c,user_id:i,onUpdateData:q})]}),r.jsxs($e,{children:[r.jsx(k,{asChild:!0,children:r.jsx(or,{activity:e,isParticipant:Y,user_id:i,onClose:o,onUpdateData:n})}),r.jsx(k,{asChild:!0,children:r.jsx(w,{variant:"outline",onClick:o,children:"Exit"})})]})]})]})};export{hr as default};
