import{c as Z,r as a,m as l,j as t,f as u,g as U,h as ee,e as te,v as re,w as oe,n as ne,x as se,l as ae,y as ie,o as ce,I as T,z as de,P as le,B as v,t as g}from"./index-DgSD1OFZ.js";import{u as $,a as pe,b as he,s as b,d as k,P as F,F as ue,f as A,H as N,c as me,S as ge,e as fe}from"./MainPage-Dn2Ri639.js";import{c as x,T as h,B as xe,I as Pe,V as je}from"./config-BQa2vKrU.js";import{G as ve,D as we,a as ye,b as Ce,c as Ae,d as Te,e as $e,f as S}from"./dialog-C25dslNj.js";import{F as De}from"./field-DyKXzH6d.js";import{B as Ee}from"./badge-DgzoqRPr.js";const[I,m]=Z({name:"PopoverContext",hookName:"usePopoverContext",providerName:"<PopoverProvider />"}),B=a.forwardRef((e,r)=>{const o=m(),n=l(o.getAnchorProps(),e);return t.jsx(u.div,{...n,ref:r})});B.displayName="PopoverAnchor";const _=a.forwardRef((e,r)=>{const o=m(),n=l(o.getArrowProps(),e);return t.jsx(u.div,{...n,ref:r})});_.displayName="PopoverArrow";const L=a.forwardRef((e,r)=>{const o=m(),n=l(o.getArrowTipProps(),e);return t.jsx(u.div,{...n,ref:r})});L.displayName="PopoverArrowTip";const O=a.forwardRef((e,r)=>{const o=m(),n=l(o.getCloseTriggerProps(),e);return t.jsx(u.button,{...n,ref:r})});O.displayName="PopoverCloseTrigger";const z=a.forwardRef((e,r)=>{const o=m(),n=$(),s=l(o.getContentProps(),n.getPresenceProps(),e);return n.unmounted?null:t.jsx(u.div,{...s,ref:U(n.ref,r)})});z.displayName="PopoverContent";const J=a.forwardRef((e,r)=>{const o=m(),n=l(o.getDescriptionProps(),e);return t.jsx(u.div,{...n,ref:r})});J.displayName="PopoverDescription";const G=a.forwardRef((e,r)=>{const o=m(),n=l(o.getIndicatorProps(),e);return t.jsx(u.div,{...n,ref:r})});G.displayName="PopoverIndicator";const H=a.forwardRef((e,r)=>{const o=m(),n=$(),s=l(o.getPositionerProps(),e);return n.unmounted?null:t.jsx(u.div,{...s,ref:r})});H.displayName="PopoverPositioner";const Se=(e={})=>{const{getRootNode:r}=ee(),{dir:o}=pe(),n={id:a.useId(),dir:o,getRootNode:r,open:e.defaultOpen,"open.controlled":e.open!==void 0,...e},s={...n,open:e.open,onOpenChange:he(e.onOpenChange,{sync:!0})},[i,p]=te(re(n),{context:s});return oe(i,p,ne)},Re=e=>{const[r,{children:o,...n}]=b(e),s=Se(n),i=k(l({present:s.open},r));return t.jsx(I,{value:s,children:t.jsx(F,{value:i,children:o})})},be=e=>{const[r,{value:o,children:n}]=b(e),s=k(l({present:o.open},r));return t.jsx(I,{value:o,children:t.jsx(F,{value:s,children:n})})},K=a.forwardRef((e,r)=>{const o=m(),n=l(o.getTitleProps(),e);return t.jsx(u.div,{...n,ref:r})});K.displayName="PopoverTitle";const V=a.forwardRef((e,r)=>{const o=m(),n=$(),s=l({...o.getTriggerProps(),"aria-controls":n.unmounted?void 0:o.getTriggerProps()["aria-controls"]},e);return t.jsx(u.button,{...s,ref:r})});V.displayName="PopoverTrigger";function R(e){return ie(e,r=>r==="auto"?"auto":`span ${r}/span ${r}`)}const P=a.forwardRef(function(r,o){const{area:n,colSpan:s,colStart:i,colEnd:p,rowEnd:f,rowSpan:c,rowStart:w,...y}=r,j=se({gridArea:n,gridColumn:R(s),gridRow:R(c),gridColumnStart:i,gridColumnEnd:p,gridRowStart:w,gridRowEnd:f});return t.jsx(ae.div,{ref:o,css:j,...y})}),{withRootProvider:W,withContext:d,useStyles:dt,PropsProvider:lt}=ce({key:"popover"});W(be);const ke=W(Re),Fe=d(V,"trigger",{forwardAsChild:!0}),Ne=d(H,"positioner",{forwardAsChild:!0}),Ie=d(z,"content",{forwardAsChild:!0}),Be=d(_,"arrow",{forwardAsChild:!0}),_e=d(L,"arrowTip",{forwardAsChild:!0}),Le=d(O,"closeTrigger",{forwardAsChild:!0});d(G,"indicator",{forwardAsChild:!0});d(K,"title",{forwardAsChild:!0});d(J,"description",{forwardAsChild:!0});d("footer","footer");d("header","header");const Oe=d("div","body");d(B,void 0,{forwardAsChild:!0});const ze=async e=>{try{const r=await fetch(`${x.backendPath}/api/activities/${e}/participants`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to fetch participants for activity ID ${e}`);return await r.json()}catch(r){throw console.error("Error fetching participants:",r),r}},Je=async e=>{try{const r=await fetch(`${x.backendPath}/api/activities/${e}/comments`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to fetch comments for activity ID ${e}`);return await r.json()}catch(r){throw console.error("Error fetching comments:",r),r}},Ge=a.forwardRef(function(r,o){return t.jsx(T,{variant:"ghost","aria-label":"Close",ref:o,...r,children:r.children??t.jsx(de,{})})}),He=a.forwardRef(function(r,o){const{portalled:n=!0,portalRef:s,...i}=r;return t.jsx(le,{disabled:!n,container:s,children:t.jsx(Ne,{children:t.jsx(Ie,{ref:o,...i})})})}),Ke=a.forwardRef(function(r,o){return t.jsx(Be,{...r,ref:o,children:t.jsx(_e,{})})});a.forwardRef(function(r,o){return t.jsx(Le,{position:"absolute",top:"1",insetEnd:"1",...r,asChild:!0,ref:o,children:t.jsx(Ge,{size:"sm"})})});const Ve=ke,We=Oe,Me=Fe,Xe=async e=>{try{const r=await fetch(`${x.backendPath}/api/activities/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to delete activity of ID ${e}`);return await r.json()}catch(r){throw console.error("Error deleting activity:",r),r}},Ye=({activity:e,onClose:r})=>{const[o,n]=a.useState(!1),s=async()=>{try{await Xe(e.activity_id),r(),g.create({description:`Deleted ${e.title}`,type:"success"})}catch{g.create({description:`Failed to delete ${e.title}`,type:"error"})}};return t.jsxs(Ve,{open:o,onOpenChange:i=>n(i.open),children:[t.jsx(Me,{children:t.jsx(T,{variant:"outline",colorPalette:"teal",children:t.jsx(ue,{})})}),t.jsxs(He,{width:"160px",children:[t.jsx(Ke,{}),t.jsxs(We,{children:[t.jsx(h,{textAlign:"center",fontSize:"md",children:"Are you sure?"}),t.jsx(v,{width:"full",marginTop:2,onClick:s,children:"Delete"})]})]})]})},qe=({activity:e,participants:r,loading:o})=>t.jsxs(t.Fragment,{children:[t.jsx(h,{textAlign:"left",fontSize:"md",color:"gray.500",mb:8,children:e.description}),t.jsxs(ve,{templateColumns:"repeat(2, 1fr)",width:"80%",overflow:"hidden",children:[t.jsx(P,{alignContent:"start",children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Duration:"})," ",A(e.start_date)," - ",A(e.end_date)]})}),t.jsx(P,{children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Location:"})," ",e.location]})}),t.jsx(P,{children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Status:"})," ",e.status]})}),t.jsx(P,{children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Vacancy:"})," ",e.participant_count,"/",e.max_participants]})}),t.jsx(P,{colSpan:2,children:t.jsxs(h,{textAlign:"start",lineClamp:1,children:[t.jsx("strong",{children:"Participants:"})," ",o?"Loading...":r.length===0?"None":r.map(n=>n.user_name).join(", ")]})})]})]}),Qe=({comment:e})=>t.jsxs(xe,{children:[t.jsxs(h,{textAlign:"start",color:"teal.300",children:[A(e.created_at),": ",t.jsx("strong",{children:e.user_name})]}),t.jsx(h,{textAlign:"start",color:"gray.300",children:e.comment_body})]}),Ze=async(e,r,o)=>{try{const n=await fetch(`${x.backendPath}/api/activities/${o}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,comment_body:r})});if(!n.ok)throw new Error(`Failed to add comment for activity ID ${o}`);return await n.json()}catch(n){throw console.error("Error adding comment:",n),n}},Ue=({activity:e,comments:r,user_id:o,onUpdateData:n})=>{const[s,i]=a.useState(""),p=async()=>{try{await Ze(o,s,e.activity_id),i(""),n(),g.create({description:"Added Comment",type:"success"})}catch{g.create({description:"Failed to add Comment",type:"error"})}},f=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),p())};return t.jsxs(t.Fragment,{children:[t.jsxs(N,{marginTop:8,children:[t.jsx(De,{width:"5/6",children:t.jsx(Pe,{value:s,onChange:c=>i(c.target.value),placeholder:"Write your comment here...",size:"md",onKeyDown:f})}),t.jsx(v,{width:"1/6",colorScheme:"teal",onClick:p,disabled:!s,children:"Submit"})]}),t.jsx(je,{spaceY:2,p:2,width:"full",align:"stretch",children:r.map(c=>t.jsx(Qe,{comment:c},c.comment_id))})]})},et=async(e,r)=>{try{const o=await fetch(`${x.backendPath}/api/activities/${r}/participants`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e})});if(!o.ok)throw new Error(`Failed to add participant for activity ID ${r}`);return await o.json()}catch(o){throw console.error("Error adding participant:",o),o}},tt=async(e,r)=>{try{const o=await fetch(`${x.backendPath}/api/activities/${r}/participants`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e})});if(!o.ok)throw new Error(`Failed to delete participant for activity ID ${r}`);return await o.json()}catch(o){throw console.error("Error deleting participant:",o),o}},rt=({activity:e,isParticipant:r,user_id:o,onClose:n,onUpdateData:s})=>{const i=async()=>{r?f():p(),n()},p=async()=>{try{if(e.participant_count===e.max_participants)throw new Error("Activity already full!");await et(o,e.activity_id),s(),g.create({description:`Joined ${e.title}`,type:"success"})}catch{g.create({description:`Failed to join ${e.title}`,type:"error"})}},f=async()=>{try{await tt(o,e.activity_id),s(),g.create({description:`Left ${e.title}`,type:"success"})}catch{g.create({description:`Failed to leave ${e.title}`,type:"error"})}};return t.jsx(v,{variant:"subtle",colorPalette:"teal",onClick:i,width:"20%",children:r?"Leave":"Join"})},pt=({activity:e,onClose:r,onUpdateData:o,onEdit:n,user_id:s})=>{const[i,p]=a.useState([]),[f,c]=a.useState([]),[w,y]=a.useState(!0),[j,M]=a.useState(!0),X=i.map(D=>D.user_id).includes(s);a.useEffect(()=>{(async()=>{try{const C=await ze(e.activity_id);p(C);const E=await Je(e.activity_id);E.sort((q,Q)=>new Date(Q.created_at).getTime()-new Date(q.created_at).getTime()),c(E)}catch(C){console.error("Error fetching data:",C)}finally{y(!1)}})()},[j]);const Y=()=>{M(!j)};return t.jsxs(we,{open:!0,size:"xl",children:[t.jsx(ye,{}),t.jsxs(Ce,{colorScheme:"teal",overflow:"auto",maxH:"80vh",css:{scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}},children:[t.jsx(Ae,{children:t.jsxs(N,{align:"center",children:[t.jsx(h,{fontSize:"2xl",fontWeight:"bold",color:"teal.600",children:e.title}),t.jsx(Ee,{colorPalette:me.get(e.category),children:e.category}),t.jsx(ge,{}),t.jsx(T,{variant:"outline",onClick:()=>n(e),colorPalette:"teal",children:t.jsx(fe,{})}),t.jsx(Ye,{activity:e,onClose:()=>{o(),r()}})]})}),t.jsxs(Te,{children:[t.jsx(qe,{activity:e,participants:i,loading:w}),t.jsx(Ue,{activity:e,comments:f,user_id:s,onUpdateData:Y})]}),t.jsxs($e,{children:[t.jsx(S,{asChild:!0,children:t.jsx(rt,{activity:e,isParticipant:X,user_id:s,onClose:r,onUpdateData:o})}),t.jsx(S,{asChild:!0,children:t.jsx(v,{variant:"outline",onClick:r,children:"Exit"})})]})]})]})};export{pt as default};
